!pip install requests==2.32.3
!pip install ibm-watsonx-ai
!pip install PyPDF2
import json
import requests
from ibm_watsonx_ai.foundation_models import ModelInference
from ibm_watsonx_ai import Credentials

# âœ… Your credentials
API_KEY = "hzPuIY9ArkA9AUC53ejUmKX-ZVx7CjZ9HXqYwZpHtLub"
PROJECT_ID = "175e0636-b309-488b-a296-fc7a95fbd42d"
MODEL_ID = "ibm/granite-13b-instruct-v2"

# âœ… Setup Watsonx Connection
credentials = Credentials(
    url="https://us-south.ml.cloud.ibm.com",
    api_key=API_KEY
)

model = ModelInference(
    model_id=MODEL_ID,
    credentials=credentials,
    project_id=PROJECT_ID
)

print("âœ… Watsonx Granite 13B model connected successfully!")

from google.colab import files
from PyPDF2 import PdfReader

# âœ… Upload the PDF
uploaded = files.upload()

# âœ… Get filename
file_name = list(uploaded.keys())[0]

# âœ… Extract text from PDF
reader = PdfReader(file_name)
raw_text = ""
for page in reader.pages:
    raw_text += page.extract_text()

print("\nğŸ“„ Extracted Text Preview:")
print(raw_text[:500])  # preview first 500 characters

print("\nğŸ“„ Extracted Text Preview:")
print(raw_text[:500])  # show first 500 characters

# âœ… Build a clean summarization prompt
prompt = f"""
You are a professional medical assistant.

Here is a patient's medical report:

{raw_text}

Please summarize the key medical history, recent complaints, lab findings, medications, and doctor's notes in simple bullet points for the doctor to review quickly.
"""

# âœ… Generate Summary
response = model.generate(prompt)
summary = response['results'][0]['generated_text']

# âœ… Display
print("\nâœ… Generated Summary:")
print(summary)

# âœ… Doctor asks a follow-up question
doctor_question = input("ğŸ‘¨â€âš•ï¸ Enter your question about the patient's report: ")

# âœ… Build prompt for QnA
qa_prompt = f"""
You are a professional medical assistant.

Here is the summarized medical report:

{summary}

The doctor asks: {doctor_question}

Answer clearly and concisely based on the report only.
"""

# âœ… Generate AI Answer
response = model.generate(qa_prompt)
answer = response['results'][0]['generated_text']

# âœ… Display
print("\nâœ… AI Answer:")
print(answer)

